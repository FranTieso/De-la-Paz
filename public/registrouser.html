<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <title>Registro de Usuario - Asociación de la Paz</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563EB',
            secondary: '#F97316',
            neutralbg: '#F3F4F6'
          }
        }
      }
    }
  </script>
</head>
<body class="flex flex-col min-h-screen bg-neutralbg text-gray-900">

<div id="nav-container"></div>

<div id="main-content" class="flex-1">
  <main class="max-w-4xl mx-auto px-6 py-12">
      <section class="text-center mb-8">
          <h2 class="text-3xl font-bold text-primary">Registro de Nuevo Usuario</h2>
          <p class="text-lg text-gray-700">Introduce tus datos para registrarte en el sistema.</p>
      </section>
      
      <div class="bg-white p-8 rounded-2xl shadow-lg border-2 border-primary">
        <form id="registro-form" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="nombre" class="block text-gray-700 font-medium">Nombre</label>
              <input type="text" id="nombre" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-secondary outline-none" required>
            </div>
            <div>
              <label for="apellido1" class="block text-gray-700 font-medium">Primer Apellido</label>
              <input type="text" id="apellido1" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-secondary outline-none" required>
            </div>
            <div>
              <label for="apellido2" class="block text-gray-700 font-medium">Segundo Apellido</label>
              <input type="text" id="apellido2" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-secondary outline-none">
            </div>
            <div>
              <label for="numeroDocumento" class="block text-gray-700 font-medium">Nº Documento</label>
              <input type="text" id="numeroDocumento" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-secondary outline-none" required>
            </div>
            <div>
              <label for="mail" class="block text-gray-700 font-medium">Correo Electrónico</label>
              <input type="email" id="mail" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-secondary outline-none" required>
            </div>
            <div>
              <label for="movil" class="block text-gray-700 font-medium">Móvil</label>
              <input type="tel" id="movil" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-secondary outline-none">
            </div>
             <div>
              <label for="password" class="block text-gray-700 font-medium">Contraseña</label>
              <input type="password" id="password" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-secondary outline-none" required>
            </div>
          </div>
          
          <div class="mt-6">
            <label class="block text-gray-700 font-medium mb-2">Roles</label>
            <div class="flex flex-wrap gap-4">
              <label class="flex items-center"><input type="checkbox" id="rol-entrenador" class="h-5 w-5 text-primary focus:ring-secondary border-gray-300 rounded"><span class="ml-2">Entrenador</span></label>
              <label class="flex items-center"><input type="checkbox" id="rol-delegado" class="h-5 w-5 text-primary focus:ring-secondary border-gray-300 rounded"><span class="ml-2">Delegado</span></label>
              <label class="flex items-center"><input type="checkbox" id="rol-arbitro" class="h-5 w-5 text-primary focus:ring-secondary border-gray-300 rounded"><span class="ml-2">Árbitro</span></label>
              <label class="flex items-center"><input type="checkbox" id="rol-administrador" class="h-5 w-5 text-primary focus:ring-secondary border-gray-300 rounded"><span class="ml-2">Administrador</span></label>
            </div>
          </div>

          <div id="equipo-container" class="hidden mt-6">
            <label for="equipo" class="block text-gray-700 font-medium">Nombre del Equipo</label>
            <input type="text" id="equipo" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-secondary outline-none">
          </div>

          <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg hover:bg-blue-800 transition font-semibold text-lg mt-8">Registrar Usuario</button>
        </form>
      </div>
  </main>
</div>

<div id="footer-container"></div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="plantilla.js"></script>
<script>
  document.addEventListener('firebaseReady', () => {
    const registroForm = document.getElementById('registro-form');
    const rolEntrenador = document.getElementById('rol-entrenador');
    const rolDelegado = document.getElementById('rol-delegado');
    const equipoContainer = document.getElementById('equipo-container');

    function toggleEquipoInput() {
      if (rolEntrenador.checked || rolDelegado.checked) {
        equipoContainer.classList.remove('hidden');
      } else {
        equipoContainer.classList.add('hidden');
      }
    }

    rolEntrenador.addEventListener('change', toggleEquipoInput);
    rolDelegado.addEventListener('change', toggleEquipoInput);
    
    registroForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const nombre = document.getElementById('nombre').value;
      const apellido1 = document.getElementById('apellido1').value;
      const apellido2 = document.getElementById('apellido2').value;
      const numeroDocumento = document.getElementById('numeroDocumento').value;
      const mail = document.getElementById('mail').value;
      const movil = document.getElementById('movil').value;
      const password = document.getElementById('password').value;

      const roles = {};
      const equipo = document.getElementById('equipo').value;

      if (document.getElementById('rol-entrenador').checked) roles.entrenador = equipo ? { equipo } : true;
      if (document.getElementById('rol-delegado').checked) roles.delegado = equipo ? { equipo } : true;
      if (document.getElementById('rol-arbitro').checked) roles.arbitro = true;
      if (document.getElementById('rol-administrador').checked) roles.administrador = true;

      const userData = { nombre, apellido1, apellido2, numeroDocumento, mail, movil, roles, contra: password };

      try {
        await db.collection('USUARIOS').doc(numeroDocumento).set(userData);

        alert('¡Usuario registrado con éxito!');
        window.location.href = 'datos.html';
        
      } catch (error) {
        console.error("Error al registrar el usuario: ", error);
        alert('Error al registrar el usuario: ' + error.message);
      }
    });
  });
</script>

</body>
</html>